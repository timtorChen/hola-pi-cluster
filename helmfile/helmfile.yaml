# Helm plugins needed: helm-diff, helm-git, helm-secrets

bases:
- common/repo.yaml

environments:
  default:
    values:
    - config.yaml
    secrets:
    - secrets.sops.yaml

templates:
  default: &default
    values:
    # values file end with .gotmpl, will be rendered as a template
    # values file end with .yaml, will be rendered verbatim
    - releases/{{`{{ .Release.Name }}`}}/values.gotmpl
  
  nginx: &nginx-ingress
    <<: *default
    chart: nginx-ingress/ingress-nginx
    version: ~3.15.2
    namespace: system
    labels: 
      type: ingress
    
  raw: &raw
    chart: incubator/raw
    version: ~0.2.3
    values:
    - raw/{{ `{{ .Release.Name }}` }}.gotmpl

releases:
- name: metallb
  <<: *default
  namespace: system
  chart: stable/metallb
  version: ~0.12.0

- name: public-ingress
  <<: *nginx-ingress

- name: personal-ingress
  <<: *nginx-ingress

- name: cert-manager
  <<: *default
  namespace: system
  chart: cert-manager/cert-manager
  version: ~v0.16.1
  
- name: cert-manager-crd
  <<: *raw
  namespace: system
  labels:
    type: crd

- name: adguard-home
  <<: *default
  namespace: system
  chart: k8s-at-home/adguard-home
  version: ~2.2.0

- name: nfs-client-provisioner
  <<: *default
  namespace: system
  chart: stable/nfs-client-provisioner
  version: ~1.2.8

- name: prometheus
  <<: *default
  namespace: system
  chart: prometheus/prometheus
  version: ~11.10.0

- name: grafana
  <<: *default
  namespace: system
  chart: grafana/grafana
  version: ~5.5.0

- name: openvpn
  <<: *default
  namespace: system
  chart: stable/openvpn
  version: ~4.2.3

- name: wg-access-server
  <<: *default
  namespace: system
  chart: wg-access-server/wg-access-server
  version: ~0.3.0

# Chart: unofficial-chart
- name: bitwarden-rs
  <<: *default
  chart: cdwv/bitwarden-k8s
  version: ~0.1.5

- name: nextcloud
  <<: *default
  chart: ./charts/nextcloud
  version: ~1.12.0

# pure yaml deployment for nextcloud-mariadb
- name: mariadb
  <<: *raw

# Chart: unofficial chart
- name: jellyfin
  <<: *default
  chart: brianmcarey/jellyfin
  version: ~0.1.0

- name:  blog
  <<: *default
  chart: timtor/blog
  version: ~0.1.0

- name: blog-draft
  <<: *default
  chart: timtor/blog
  version: ~0.1.0